<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Test Reference Docs</title>
    <script src="../js/referenceDocs.js"></script>

    <style>
    table{
        border: 1px solid black;
    }
    th, td{
        border: 1px solid black;
        border-collapse: collapse;
    }
    </style>
</head>
<body>
<h1>ReferenceDocs-JSのテストページ</h1>
<p>it says "quoted document"<ref-doc doc-id="bookSource" doc-pages="p.27"></ref-doc>.
    Also, the other one says "document quoted"<ref-doc doc-id="webSource"></ref-doc>.</p>
<ref-doc>
   <ref-doc-id>bookSource</ref-doc-id>
   <ref-doc-name>document name</ref-doc-name>
   <ref-doc-author>who write it</ref-doc-author>
   <ref-book-publisher>published by</ref-book-publisher>
   <ref-book-published-date>2022/03/02</ref-book-published-date>
</ref-doc>
<ref-doc>
   <ref-doc-id>webSource</ref-doc-id>
   <ref-doc-name>web page name</ref-doc-name>
   <ref-doc-author>who write it</ref-doc-author>
   <ref-web-link>https://yui-kitamura.eng.pro/hoge</ref-web-link>
   <ref-web-visited-date>2022/03/04</ref-web-visited-date>
</ref-doc>
<ref-doc-list></ref-doc-list>

<script>
function assert(actual, expected) {
  let result = (actual === expected);
  if(Array.isArray(actual) && Array.isArray(expected)){
    if(actual.length == expected.length){
      result = true;
      for(let ai = 0; ai < actual.length; ai++){
        if(actual[ai] === expected[ai]){
          continue;
        }
        result = false;
        break;
      }
    }else{
      result = false;
    }
  }else{
    if(typeof(actual) === typeof(expected)){
      const actProps = Object.getOwnPropertyNames(actual);
      const expProps = Object.getOwnPropertyNames(expected);

      result = true;
      if (actProps.length != expProps.length) {
        result = false;
      }else{
        for (var i = 0; i < actProps.length; i++) {
          const propName = actProps[i];
          if (actual[propName] !== expected[propName]) {
            result = false;
          }
        }
      }
    }
  }
  if(result){
    console.log('> assertion success');
    return true;
  }else{
    console.error('> assertion failed');
    console.dir(actual);
    console.dir(expected);
    return false;
  }
}

</script>

<table>
    <caption>テストケース</caption>
    <thead>
        <tr><th scope="col">#</th><th scope="col">case</th><th scope="col">result</th></tr>
    </thead>
    <tbody>
        <tr>
            <th scope="row">1</th><td>init check</td><td>
            <span id="test1result"></span>
            <script>
                console.log('test #1');
                referenceDocs.fn.init();
                let as1_1 = assert(0, referenceDocs.val._refCnt);
                let as1_2 = assert([], referenceDocs.val._docInfoList);
                let as1_3 = assert([], referenceDocs.val._referenceList);
                if(as1_1 && as1_2 && as1_3){
                    document.getElementById('test1result').innerHTML = 'success';
                }else{
                    document.getElementById('test1result').innerHTML = 'failed';
                    document.getElementById('test1result').style.color = 'red';
                }
            </script>
            </td>
        </tr>
        <tr>
            <th scope="row">2</th><td>get empty doc object</td><td>
            <span id="test2result"></span>
            <script>
                console.log('test #2');
                let as2 = assert({
                    docId: null,
                    docName: null,
                    docAuthor: null,
                    docPublisher: null,
                    docPubDate: null,
                    docLink: null,
                    docVisitedDate: null
                }, referenceDocs.val.emptyDocInfo());
                if(as2){
                    document.getElementById('test2result').innerHTML = 'success';
                }else{
                    document.getElementById('test2result').innerHTML = 'failed';
                    document.getElementById('test2result').style.color = 'red';
                }
            </script>
            </td>
        </tr>
        <tr>
            <th scope="row">3</th><td>get empty ref object</td><td>
            <span id="test3result"></span>
            <script>
                console.log('test #3');
                let as3 = assert({
                    refNo: null,
                    docId: null,
                    docPages: null
                }, referenceDocs.val.emptyRefInfo());
                if(as3){
                    document.getElementById('test3result').innerHTML = 'success';
                }else{
                    document.getElementById('test3result').innerHTML = 'failed';
                    document.getElementById('test3result').style.color = 'red';
                }
            </script>
            </td>
        </tr>
        <tr>
            <th scope="row">4</th><td>add doc object</td><td>
            <span id="test4result"></span>
            <script>
                console.log('test #4');
                referenceDocs.val.addInfo('id1', 'name1', 'author1', 'pub1', 'date1', null, null);
                const ref4_0 = referenceDocs.val._docInfoList[0];
                let as4 = assert({
                    docId: 'id1',
                    docName: 'name1',
                    docAuthor: 'author1',
                    docPublisher: 'pub1',
                    docPubDate: 'date1',
                    docLink: null,
                    docVisitedDate: null
                }, ref4_0);
                if(as4){
                    document.getElementById('test4result').innerHTML = 'success';
                }else{
                    document.getElementById('test4result').innerHTML = 'failed';
                    document.getElementById('test4result').style.color = 'red';
                }
            </script>
            </td>
        </tr>
        <tr>
            <th scope="row">5</th><td>add doc object - web article</td><td>
            <span id="test5result"></span>
            <script>
                console.log('test #5');
                referenceDocs.fn.init();
                referenceDocs.val.addInfo('id1', 'name1', 'author1', null, null, 'adr1', 'visDate1');
                const ref5_0 = referenceDocs.val._docInfoList[0];
                let as5 = assert({
                    docId: 'id1',
                    docName: 'name1',
                    docAuthor: 'author1',
                    docPublisher: null,
                    docPubDate: null,
                    docLink: 'adr1',
                    docVisitedDate: 'visDate1'
                }, ref5_0);
                if(as5){
                    document.getElementById('test5result').innerHTML = 'success';
                }else{
                    document.getElementById('test5result').innerHTML = 'failed';
                    document.getElementById('test5result').style.color = 'red';
                }
            </script>
            </td>
        </tr>
        <tr>
            <th scope="row">6</th><td>do not override info</td><td>
            <span id="test6result"></span>
            <script>
                console.log('test #6');
                referenceDocs.fn.init();
                referenceDocs.val.addInfo('id1', 'name1', 'author1', 'pub1', 'pubDate1', 'adr1', 'visDate1');
                referenceDocs.val.addInfo('id1', '1eman', '1rohtua', '1bup', '1etaDbup', '1rda', '1etaDsiv');
                const ref6_0 = referenceDocs.val._docInfoList[0];
                let as6 = assert({
                    docId: 'id1',
                    docName: 'name1',
                    docAuthor: 'author1',
                    docPublisher: 'pub1',
                    docPubDate: 'pubDate1',
                    docLink: 'adr1',
                    docVisitedDate: 'visDate1'
                }, ref6_0);
                if(as6){
                    document.getElementById('test6result').innerHTML = 'success';
                }else{
                    document.getElementById('test6result').innerHTML = 'failed';
                    document.getElementById('test6result').style.color = 'red';
                }
            </script>
            </td>
        </tr>
        <tr>
            <th scope="row">7</th><td>override null info</td><td>
            <span id="test7result"></span>
            <script>
                console.log('test #7');
                referenceDocs.fn.init();
                referenceDocs.val.addInfo('id1', null, null, null, null, null, null);
                referenceDocs.val.addInfo('id1', '1eman', '1rohtua', '1bup', '1etaDbup', '1rda', '1etaDsiv');
                const ref7_0 = referenceDocs.val._docInfoList[0];
                let as7 = assert({
                    docId: 'id1',
                    docName: '1eman',
                    docAuthor: '1rohtua',
                    docPublisher: '1bup',
                    docPubDate: '1etaDbup',
                    docLink: '1rda',
                    docVisitedDate: '1etaDsiv'
                }, ref7_0);
                if(as7){
                    document.getElementById('test7result').innerHTML = 'success';
                }else{
                    document.getElementById('test7result').innerHTML = 'failed';
                    document.getElementById('test7result').style.color = 'red';
                }
            </script>
            </td>
        </tr>
    </tbody>
</table>


</body>
</html>